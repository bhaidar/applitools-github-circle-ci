'use strict';
const {name, version} = require('../package.json');

function addVersionPrefix(filename) {
  return {
    generateBundle: function(_outputOptions, bundle, _isWrite) {
      const bundleFile = bundle[`${filename}.js`];
      const nextMinor = parseInt(version.match(/\.(\d+)$/)[1]) + 1;
      const nextVersion = version.replace(/(\d+)$/, nextMinor);
      bundleFile.code = `/* ${name}@${nextVersion} */\n${bundleFile.code}`;
    },
  };
}

module.exports = addVersionPrefix;
